%clc;
%clear;
% Generated by MATLAB(R) 23.2 (R2023b) and WLAN Toolbox 23.2 (R2023b).
% Generated on: 12-Apr-2024 12:20:04

%% 802.11ax 파형 생성
% 802.11ax 구성
heSUCfg = wlanHESUConfig('ChannelBandwidth', 'CBW160', ...
    'NumTransmitAntennas', 1, ...
    'NumSpaceTimeStreams', 1, ...
    'SpatialMapping', 'Direct', ...
    'PreHESpatialMapping', false, ...
    'MCS', 2, ...
    'ChannelCoding', 'LDPC', ...
    'APEPLength', 100, ...
    'GuardInterval', 3.2, ...
    'HELTFType', 4, ...
    'UplinkIndication', false, ...
    'BSSColor', 0, ...
    'SpatialReuse', 0, ...
    'TXOPDuration', 127, ...
    'HighDoppler', false, ...
    'NominalPacketPadding', 0);


numPackets = 1;
% input bit source:
in = randi([0, 1], 1000, 1);


% 생성
waveform = wlanWaveformGenerator(in, heSUCfg, ...
    'NumPackets', numPackets, ...
    'IdleTime', 0, ...
    'OversamplingFactor', 1, ...
    'ScramblerInitialization', 93, ...
    'WindowTransitionTime', 1e-07);

Fs = wlanSampleRate(heSUCfg, 'OversamplingFactor', 1); 								 % 파형의 샘플 레이트(Hz) 지정

%% 손상
% AWGN
waveform = awgn(waveform, 20, 'measured');

%% 시각화
% Spectrum Analyzer
spectrum = spectrumAnalyzer('SampleRate', Fs);
spectrum(waveform);
release(spectrum);

% RU Assignment and Allocated Subcarriers:
showAllocation(heSUCfg);
data=waveform;
data_I=real(data);
data_Q=imag(data);
fileID = fopen('data.mat','w');
for i = 1:length(waveform)
    fwrite(fileID, data_I(i), 'double');
    fwrite(fileID, data_Q(i), 'double');
end
fclose(fileID);
